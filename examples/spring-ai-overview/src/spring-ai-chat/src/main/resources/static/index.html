<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring AI Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; color: #333; }
        header { background: #1a1a2e; color: #fff; padding: 1.5rem 2rem; }
        header h1 { font-size: 1.4rem; font-weight: 600; }
        header p { font-size: 0.85rem; color: #aaa; margin-top: 0.3rem; }
        .container { max-width: 900px; margin: 1.5rem auto; padding: 0 1rem; }
        .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .tab { padding: 0.6rem 1.2rem; border: none; background: #e0e0e0; border-radius: 8px 8px 0 0;
               cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: all 0.2s; }
        .tab.active { background: #fff; color: #1a1a2e; box-shadow: 0 -2px 4px rgba(0,0,0,0.05); }
        .tab:hover { background: #d0d0d0; }
        .tab.active:hover { background: #fff; }
        .panel { display: none; background: #fff; border-radius: 0 8px 8px 8px; padding: 1.5rem;
                 box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .panel.active { display: block; }
        .input-group { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .input-group input, .input-group select { flex: 1; padding: 0.7rem; border: 1px solid #ddd;
                 border-radius: 6px; font-size: 0.95rem; }
        .input-group input:focus { outline: none; border-color: #4a6cf7; }
        button.send { padding: 0.7rem 1.5rem; background: #4a6cf7; color: #fff; border: none;
                      border-radius: 6px; cursor: pointer; font-size: 0.95rem; font-weight: 500; transition: background 0.2s; }
        button.send:hover { background: #3a5ce5; }
        button.send:disabled { background: #aaa; cursor: not-allowed; }
        .output { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem;
                  min-height: 120px; white-space: pre-wrap; word-break: break-word; font-size: 0.9rem; line-height: 1.6; }
        .output.json { font-family: 'SF Mono', 'Fira Code', monospace; font-size: 0.85rem; }
        .output .cursor { display: inline-block; width: 2px; height: 1em; background: #4a6cf7; animation: blink 0.8s infinite; vertical-align: text-bottom; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .label { font-size: 0.8rem; color: #888; margin-bottom: 0.4rem; }
        .badge { display: inline-block; padding: 0.15rem 0.5rem; background: #e8f0fe; color: #1a73e8;
                 border-radius: 4px; font-size: 0.75rem; font-weight: 500; margin-bottom: 1rem; }
        .status { font-size: 0.8rem; color: #888; margin-top: 0.5rem; }
        .status.error { color: #e53935; }
        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
        @media (max-width: 600px) { .two-col { grid-template-columns: 1fr; } }
        /* ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ */
        .output.md h1, .output.md h2, .output.md h3 { margin: 0.8rem 0 0.4rem; }
        .output.md h1 { font-size: 1.2rem; } .output.md h2 { font-size: 1.1rem; } .output.md h3 { font-size: 1rem; }
        .output.md p { margin: 0.4rem 0; }
        .output.md ul, .output.md ol { margin: 0.4rem 0 0.4rem 1.5rem; }
        .output.md code { background: #e9ecef; padding: 0.15rem 0.4rem; border-radius: 3px; font-size: 0.85em; }
        .output.md pre { background: #2d2d2d; color: #f8f8f2; padding: 0.8rem; border-radius: 6px; overflow-x: auto; margin: 0.5rem 0; }
        .output.md pre code { background: none; color: inherit; padding: 0; }
        .output.md table { border-collapse: collapse; width: 100%; margin: 0.5rem 0; }
        .output.md th, .output.md td { border: 1px solid #ddd; padding: 0.4rem 0.6rem; text-align: left; font-size: 0.85rem; }
        .output.md th { background: #f0f0f0; font-weight: 600; }
        .output.md blockquote { border-left: 3px solid #4a6cf7; padding-left: 0.8rem; color: #666; margin: 0.5rem 0; }
        .output.md strong { font-weight: 600; }
    </style>
</head>
<body>
    <header>
        <h1>Spring AI + Ollama Demo</h1>
        <p>Java ì½”ë“œ ëª‡ ì¤„ë¡œ AI ì±—ë´‡ â€” ëª¨ë¸ì„ ë°”ê¿”ë„ ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ</p>
    </header>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('chat')">Chat</button>
            <button class="tab" onclick="showTab('stream')">Streaming</button>
            <button class="tab" onclick="showTab('expert')">Prompt Lab</button>
            <button class="tab" onclick="showTab('analyze')">Structured</button>
            <button class="tab" onclick="showTab('sentiment')">Sentiment</button>
        </div>

        <!-- ê¸°ë³¸ ì±— -->
        <div id="panel-chat" class="panel active">
            <span class="badge">GET /chat</span>
            <p class="label">ChatClient.prompt().user(message).call().content()</p>
            <div class="input-group">
                <input id="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="ì¸ê³µì§€ëŠ¥ì´ ë­”ì§€ í•œ ì¤„ë¡œ ì„¤ëª…í•´ì¤˜">
                <button class="send" onclick="doChat()">ì „ì†¡</button>
            </div>
            <div id="chat-output" class="output">ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
            <div id="chat-status" class="status"></div>
        </div>

        <!-- ìŠ¤íŠ¸ë¦¬ë° -->
        <div id="panel-stream" class="panel">
            <span class="badge">GET /chat/stream (SSE)</span>
            <p class="label">ChatClient.prompt().user(message).stream().content()</p>
            <div class="input-group">
                <input id="stream-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="Spring AIë¥¼ í•œ ë¬¸ë‹¨ìœ¼ë¡œ ì„¤ëª…í•´ì¤˜">
                <button class="send" onclick="doStream()">ì „ì†¡</button>
            </div>
            <div id="stream-output" class="output">ì‹¤ì‹œê°„ìœ¼ë¡œ í† í°ì´ ì¶œë ¥ë©ë‹ˆë‹¤.</div>
            <div id="stream-status" class="status"></div>
        </div>

        <!-- í”„ë¡¬í”„íŠ¸ Lab -->
        <div id="panel-expert" class="panel">
            <span class="badge">GET /chat/expert</span>
            <p class="label">ChatClient.prompt().system(ì—­í• +ëŒ€ìƒ+í˜•ì‹+ë§íˆ¬).user(message).call().content()</p>
            <datalist id="dl-role">
                <option value="ë³´ì•ˆ ì „ë¬¸ê°€">
                <option value="í•œì‹ ì „ë¬¸ê°€">
                <option value="ìœ ì¹˜ì› ì„ ìƒë‹˜">
                <option value="Java ì‹œë‹ˆì–´ ê°œë°œì">
                <option value="ìŠ¤íƒ€íŠ¸ì—… ëŒ€í‘œ">
                <option value="ì¡°ì„ ì‹œëŒ€ ì„ ë¹„">
            </datalist>
            <datalist id="dl-audience">
                <option value="ì´ˆë“±í•™ìƒ">
                <option value="ëŒ€í•™ìƒ">
                <option value="í˜„ì—… ê°œë°œì">
                <option value="CTO/ê²½ì˜ì§„">
            </datalist>
            <datalist id="dl-format">
                <option value="3ì¤„ ìš”ì•½ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.">
                <option value="ë§ˆí¬ë‹¤ìš´ í‘œë¡œ ì •ë¦¬í•˜ì„¸ìš”.">
                <option value="ë¹„ìœ ë¥¼ ì‚¬ìš©í•´ì„œ ì„¤ëª…í•˜ì„¸ìš”.">
                <option value="ì½”ë“œ ì˜ˆì‹œë¥¼ í¬í•¨í•´ì„œ ì„¤ëª…í•˜ì„¸ìš”.">
                <option value="ì¥ì ê³¼ ë‹¨ì ì„ ë‚˜ëˆ ì„œ ë¹„êµí•˜ì„¸ìš”.">
            </datalist>
            <datalist id="dl-tone">
                <option value="ê²©ì‹ì²´(í•©ì‡¼ì²´)ë¡œ ì‘ì„±í•˜ì„¸ìš”.">
                <option value="ì¹œê·¼í•˜ê³  ìºì£¼ì–¼í•˜ê²Œ ë§í•˜ì„¸ìš”.">
                <option value="ì¬ì¹˜ ìˆê³  ìœ ë¨¸ëŸ¬ìŠ¤í•˜ê²Œ ë§í•˜ì„¸ìš”.">
                <option value="ê°„ê²°í•˜ê³  ë‹¨í˜¸í•˜ê²Œ í•µì‹¬ë§Œ ë§í•˜ì„¸ìš”.">
            </datalist>
            <div class="two-col">
                <div>
                    <div class="label" style="margin-top:0.5rem">ì—­í•  (role)</div>
                    <input id="expert-role" list="dl-role" placeholder="ì„ íƒ ë˜ëŠ” ì§ì ‘ ì…ë ¥" value="ë³´ì•ˆ ì „ë¬¸ê°€" style="width:100%; padding:0.7rem; border:1px solid #ddd; border-radius:6px; font-size:0.95rem;">
                </div>
                <div>
                    <div class="label" style="margin-top:0.5rem">ëŒ€ìƒ ìˆ˜ì¤€ (audience)</div>
                    <input id="expert-audience" list="dl-audience" placeholder="ì„ íƒ ë˜ëŠ” ì§ì ‘ ì…ë ¥ (ë¹„ì›Œë‘ë©´ ìƒëµ)" style="width:100%; padding:0.7rem; border:1px solid #ddd; border-radius:6px; font-size:0.95rem;">
                </div>
            </div>
            <div class="two-col" style="margin-top:0.5rem">
                <div>
                    <div class="label">ì¶œë ¥ í˜•ì‹ (format)</div>
                    <input id="expert-format" list="dl-format" placeholder="ì„ íƒ ë˜ëŠ” ì§ì ‘ ì…ë ¥ (ë¹„ì›Œë‘ë©´ ììœ )" style="width:100%; padding:0.7rem; border:1px solid #ddd; border-radius:6px; font-size:0.95rem;">
                </div>
                <div>
                    <div class="label">ë§íˆ¬ (tone)</div>
                    <input id="expert-tone" list="dl-tone" placeholder="ì„ íƒ ë˜ëŠ” ì§ì ‘ ì…ë ¥ (ë¹„ì›Œë‘ë©´ ê¸°ë³¸)" style="width:100%; padding:0.7rem; border:1px solid #ddd; border-radius:6px; font-size:0.95rem;">
                </div>
            </div>
            <div style="margin-top:0.8rem">
                <div class="label">ì§ˆë¬¸ (message)</div>
                <input id="expert-input" placeholder="ì§ˆë¬¸" value="SQL Injectionì´ ë­ì•¼?" style="width:100%; padding:0.7rem; border:1px solid #ddd; border-radius:6px; font-size:0.95rem;">
            </div>
            <div style="margin-top:0.8rem">
                <button class="send" onclick="doExpert()">ì „ì†¡</button>
            </div>
            <div id="expert-output" class="output" style="margin-top:1rem">ì—­í• ì— ë”°ë¼ ë‹µë³€ ìŠ¤íƒ€ì¼ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.</div>
            <div id="expert-status" class="status"></div>
        </div>

        <!-- êµ¬ì¡°í™” ì¶œë ¥ -->
        <div id="panel-analyze" class="panel">
            <span class="badge">GET /analyze</span>
            <p class="label">ChatClient.prompt().user(message).call().entity(TechAnalysis.class)</p>
            <div class="input-group">
                <input id="analyze-input" placeholder="ë¶„ì„í•  ê¸°ìˆ  ì£¼ì œ" value="Spring AI">
                <button class="send" onclick="doAnalyze()">ë¶„ì„</button>
            </div>
            <div id="analyze-output" class="output json">AIê°€ Java record(JSON)ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤.</div>
            <div id="analyze-status" class="status"></div>
        </div>

        <!-- ê°ì„± ë¶„ì„ -->
        <div id="panel-sentiment" class="panel">
            <span class="badge">GET /sentiment</span>
            <p class="label">AI í…ìŠ¤íŠ¸ ë¶„ì„ â†’ Java record â†’ JSON â†’ ì‹œê°í™” (íŒŒì‹± ì½”ë“œ ì—†ìŒ)</p>
            <div class="label" style="margin-top:0.5rem">ë¦¬ë·° / ëŒ“ê¸€ / í”¼ë“œë°± í…ìŠ¤íŠ¸</div>
            <textarea id="sentiment-input" rows="3" placeholder="ë¶„ì„í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                style="width:100%; padding:0.7rem; border:1px solid #ddd; border-radius:6px; font-size:0.95rem; resize:vertical; font-family:inherit;">ì´ ì œí’ˆ ì •ë§ ì¢‹ì•„ìš”! ë°°ì†¡ë„ ë¹ ë¥´ê³  í¬ì¥ë„ ê¼¼ê¼¼í–ˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ê°€ê²©ì´ ì¡°ê¸ˆ ë¹„ì‹¼ ëŠë‚Œì´ì—ìš”.</textarea>
            <div style="margin-top:0.5rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
                <button class="send" onclick="doSentiment()">ë¶„ì„</button>
                <button class="send" style="background:#6c757d;" onclick="setSampleText(0)">ê¸ì • ì˜ˆì‹œ</button>
                <button class="send" style="background:#6c757d;" onclick="setSampleText(1)">ë¶€ì • ì˜ˆì‹œ</button>
                <button class="send" style="background:#6c757d;" onclick="setSampleText(2)">ì¤‘ë¦½ ì˜ˆì‹œ</button>
            </div>
            <div id="sentiment-card" style="display:none; margin-top:1rem; background:#f8f9fa; border:1px solid #e9ecef; border-radius:8px; padding:1.2rem;">
                <div style="display:flex; align-items:center; gap:1rem; margin-bottom:1rem;">
                    <span id="sent-emoji" style="font-size:3rem;"></span>
                    <div style="flex:1;">
                        <div id="sent-label" style="font-size:1.1rem; font-weight:600;"></div>
                        <div style="margin-top:0.4rem; background:#e9ecef; border-radius:99px; height:12px; overflow:hidden;">
                            <div id="sent-bar" style="height:100%; border-radius:99px; transition:width 0.6s ease;"></div>
                        </div>
                        <div id="sent-score" style="font-size:0.8rem; color:#888; margin-top:0.2rem;"></div>
                    </div>
                </div>
                <div id="sent-summary" style="font-size:0.95rem; margin-bottom:0.8rem; line-height:1.5;"></div>
                <div id="sent-keywords" style="display:flex; gap:0.4rem; flex-wrap:wrap;"></div>
            </div>
            <div id="sentiment-raw" style="display:none; margin-top:0.8rem;">
                <div class="label" style="cursor:pointer; color:#4a6cf7;" onclick="toggleRaw()">Raw JSON â–¾</div>
                <div id="sentiment-json" class="output json" style="display:none; margin-top:0.3rem; font-size:0.8rem;"></div>
            </div>
            <div id="sentiment-status" class="status"></div>
        </div>
    </div>

    <script>
        function showTab(name) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('panel-' + name).classList.add('active');
        }

        function setStatus(id, text, isError) {
            const el = document.getElementById(id);
            el.textContent = text;
            el.className = isError ? 'status error' : 'status';
        }

        function setLoading(btnEl, loading) {
            btnEl.disabled = loading;
            btnEl.textContent = loading ? '...' : (btnEl.dataset.label || 'ì „ì†¡');
        }

        function renderMd(el, text) {
            el.classList.add('md');
            el.innerHTML = marked.parse(text);
        }

        // ê¸°ë³¸ ì±—
        async function doChat() {
            const btn = event.target; btn.dataset.label = btn.textContent;
            const msg = document.getElementById('chat-input').value;
            const out = document.getElementById('chat-output');
            out.textContent = ''; setLoading(btn, true); setStatus('chat-status', 'ìš”ì²­ ì¤‘...');
            try {
                const t0 = Date.now();
                const res = await fetch('/chat?message=' + encodeURIComponent(msg));
                if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
                renderMd(out, await res.text());
                setStatus('chat-status', `ì™„ë£Œ (${((Date.now() - t0) / 1000).toFixed(1)}ì´ˆ)`);
            } catch (e) { out.textContent = ''; setStatus('chat-status', 'Error: ' + e.message, true); }
            setLoading(btn, false);
        }

        // ìŠ¤íŠ¸ë¦¬ë° â€” fetch + ReadableStream (SSE ê³µë°± ì†ì‹¤ ë°©ì§€)
        async function doStream() {
            const btn = event.target; btn.dataset.label = btn.textContent;
            const msg = document.getElementById('stream-input').value;
            const out = document.getElementById('stream-output');
            out.textContent = ''; out.classList.remove('md');
            setLoading(btn, true); setStatus('stream-status', 'ìŠ¤íŠ¸ë¦¬ë° ì¤‘...');
            const t0 = Date.now();
            let fullText = '';
            try {
                const res = await fetch('/chat/stream?message=' + encodeURIComponent(msg));
                if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
                const reader = res.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    buffer += decoder.decode(value, { stream: true });
                    const parts = buffer.split('\n\n');
                    buffer = parts.pop();
                    for (const part of parts) {
                        for (const line of part.split('\n')) {
                            if (line.startsWith('data:')) {
                                const token = line.substring(5);
                                fullText += token;
                                out.textContent = fullText;
                            }
                        }
                    }
                }
                // ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ í›„ ë§ˆí¬ë‹¤ìš´ ë Œë”ë§
                renderMd(out, fullText);
                setStatus('stream-status', `ì™„ë£Œ (${((Date.now() - t0) / 1000).toFixed(1)}ì´ˆ)`);
            } catch (e) { setStatus('stream-status', 'Error: ' + e.message, true); }
            setLoading(btn, false);
        }

        // í”„ë¡¬í”„íŠ¸ Lab
        async function doExpert() {
            const btn = event.target; btn.dataset.label = btn.textContent;
            const role = document.getElementById('expert-role').value;
            const audience = document.getElementById('expert-audience').value;
            const format = document.getElementById('expert-format').value;
            const tone = document.getElementById('expert-tone').value;
            const msg = document.getElementById('expert-input').value;
            const out = document.getElementById('expert-output');
            out.textContent = ''; setLoading(btn, true); setStatus('expert-status', 'ìš”ì²­ ì¤‘...');
            try {
                const t0 = Date.now();
                const params = new URLSearchParams({ role, message: msg });
                if (audience) params.set('audience', audience);
                if (format) params.set('format', format);
                if (tone) params.set('tone', tone);
                const url = '/chat/expert?' + params.toString();
                const res = await fetch(url);
                if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
                renderMd(out, await res.text());
                setStatus('expert-status', `ì™„ë£Œ (${((Date.now() - t0) / 1000).toFixed(1)}ì´ˆ)`);
            } catch (e) { out.textContent = ''; setStatus('expert-status', 'Error: ' + e.message, true); }
            setLoading(btn, false);
        }

        // êµ¬ì¡°í™” ì¶œë ¥
        async function doAnalyze() {
            const btn = event.target; btn.dataset.label = btn.textContent;
            const topic = document.getElementById('analyze-input').value;
            const out = document.getElementById('analyze-output');
            out.textContent = ''; setLoading(btn, true); setStatus('analyze-status', 'ë¶„ì„ ì¤‘...');
            try {
                const t0 = Date.now();
                const res = await fetch('/analyze?topic=' + encodeURIComponent(topic));
                if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
                const json = await res.json();
                out.textContent = JSON.stringify(json, null, 2);
                setStatus('analyze-status', `ì™„ë£Œ (${((Date.now() - t0) / 1000).toFixed(1)}ì´ˆ)`);
            } catch (e) { out.textContent = ''; setStatus('analyze-status', 'Error: ' + e.message, true); }
            setLoading(btn, false);
        }

        // ê°ì„± ë¶„ì„
        const sampleTexts = [
            'ì´ ì„œë¹„ìŠ¤ ìµœê³ ì˜ˆìš”! ì§ì›ë¶„ë“¤ë„ ì¹œì ˆí•˜ê³ , ìŒì‹ë„ ë§›ìˆê³ , ë¶„ìœ„ê¸°ë„ ë„ˆë¬´ ì¢‹ì•˜ìŠµë‹ˆë‹¤. ê¼­ ë‹¤ì‹œ ì˜¬ê²Œìš”!',
            'ìµœì•…ì˜ ê²½í—˜ì´ì—ˆìŠµë‹ˆë‹¤. ì£¼ë¬¸í•œ ì§€ 1ì‹œê°„ì´ ì§€ë‚˜ë„ ì•ˆ ì˜¤ê³ , ë¬¸ì˜í•˜ë‹ˆê¹Œ ë¶ˆì¹œì ˆí•˜ê¸°ê¹Œì§€. í™˜ë¶ˆ ìš”ì²­í–ˆëŠ”ë° ì•„ì§ë„ ì²˜ë¦¬ê°€ ì•ˆ ëë„¤ìš”.',
            'ë°°ì†¡ì€ ì˜ˆì •ëŒ€ë¡œ ì™”ê³  ì œí’ˆ ìƒíƒœë„ ê´œì°®ìŠµë‹ˆë‹¤. íŠ¹ë³„íˆ ì¢‹ê±°ë‚˜ ë‚˜ìœ ì ì€ ì—†ì—ˆìŠµë‹ˆë‹¤.'
        ];
        function setSampleText(idx) {
            document.getElementById('sentiment-input').value = sampleTexts[idx];
        }
        function toggleRaw() {
            const el = document.getElementById('sentiment-json');
            el.style.display = el.style.display === 'none' ? 'block' : 'none';
        }
        async function doSentiment() {
            const btn = event.target; btn.dataset.label = btn.textContent;
            const text = document.getElementById('sentiment-input').value;
            const card = document.getElementById('sentiment-card');
            const rawWrap = document.getElementById('sentiment-raw');
            card.style.display = 'none'; rawWrap.style.display = 'none';
            setLoading(btn, true); setStatus('sentiment-status', 'ë¶„ì„ ì¤‘...');
            try {
                const t0 = Date.now();
                const res = await fetch('/sentiment?text=' + encodeURIComponent(text));
                if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
                const data = await res.json();

                // ì‹œê°í™”
                const sentMap = {
                    POSITIVE: { emoji: 'ğŸ˜Š', color: '#4caf50', label: 'ê¸ì •' },
                    NEUTRAL:  { emoji: 'ğŸ˜', color: '#ff9800', label: 'ì¤‘ë¦½' },
                    NEGATIVE: { emoji: 'ğŸ˜ ', color: '#f44336', label: 'ë¶€ì •' }
                };
                const s = sentMap[data.sentiment] || sentMap.NEUTRAL;

                document.getElementById('sent-emoji').textContent = s.emoji;
                document.getElementById('sent-label').textContent = s.label;
                document.getElementById('sent-label').style.color = s.color;
                document.getElementById('sent-bar').style.width = data.score + '%';
                document.getElementById('sent-bar').style.background = s.color;
                document.getElementById('sent-score').textContent = `ê°ì„± ì ìˆ˜: ${data.score}/100`;
                document.getElementById('sent-summary').textContent = data.summary || '';

                const kwEl = document.getElementById('sent-keywords');
                kwEl.innerHTML = '';
                (data.keywords || []).forEach(kw => {
                    const tag = document.createElement('span');
                    tag.textContent = kw;
                    tag.style.cssText = `display:inline-block; padding:0.2rem 0.6rem; background:${s.color}20; color:${s.color}; border:1px solid ${s.color}40; border-radius:99px; font-size:0.8rem; font-weight:500;`;
                    kwEl.appendChild(tag);
                });

                card.style.display = 'block';
                rawWrap.style.display = 'block';
                document.getElementById('sentiment-json').textContent = JSON.stringify(data, null, 2);

                setStatus('sentiment-status', `ì™„ë£Œ (${((Date.now() - t0) / 1000).toFixed(1)}ì´ˆ)`);
            } catch (e) { setStatus('sentiment-status', 'Error: ' + e.message, true); }
            setLoading(btn, false);
        }

        // Enter key support
        document.querySelectorAll('input, textarea').forEach(el => {
            el.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey && el.tagName !== 'TEXTAREA') {
                    const panel = el.closest('.panel');
                    panel.querySelector('button.send').click();
                }
            });
        });
    </script>
</body>
</html>
